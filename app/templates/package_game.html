<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{{ package.productname }}</title>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="../static/css/style.css"/>
    <script src="../static/libs/jquery-3.1.0.js"></script>

</head>
<body class="package">
<div class="bar_top">
    <a href="game"><img src="../static/img/back.png" alt=""/></a>
</div>
<div class="super">
    <div class="super_left">
        <img src="../static/img/super.png" alt="{{ package.productname }}"/>
    </div>
    <div class="super_right">
        <ul>
            <li>{{ package.productname }}</li>
            <li>推荐指数
                <img src="../static/img/ysolid.png" alt=""/>
                <img src="../static/img/ysolid.png" alt=""/>
                <img src="../static/img/ysolid.png" alt=""/>
                <img src="../static/img/yempty.png" alt=""/>
                <img src="../static/img/yempty.png" alt=""/>
            </li>
            <li>资费：{{ package.price }}元/月</li>
        </ul>
    </div>
    <button>订&#x3000购</button>
    <div class="clear"></div>
</div>
<div id="main">
    <div class="order">
        <div class="order_top">提示</div>
        <div class="order_bottom">
            <p>您将订购{{ package.productname }}</p>
            <button class="cancel">取消</button>
            <button class="confirm">确认</button>
        </div>
    </div>
</div>

<div class="summary">
    <p>游戏包概括：</p>
    <p>{{ package.description }}</p>

</div>
<div class="summary style">
    <p>12款游戏：</p>
    <ul>
        {% for g in games %}
            <li><a href="gamedetail?id={{ g.id }}"><img src="{{ g.img_icon }}" alt=""/></a></li>
        {% endfor %}
    </ul>

</div>
</body>
<script type="application/javascript">
    {% if flag %}
        $('.super button').text('已订购');
        $('.super button').addClass('ordered');
    {% else %}
        $('.super button').click(function () {
        $('#main').show()
    });
    $('.order_bottom .cancel').click(function () {
        $('#main').hide()
    });
    $('.order_bottom .confirm').click(function () {
        $('#main').hide();

        $.ajax({
            type: "post",
            url: "/api/v1.0/orders?action=subscribe",
            data: {
                'spid': '{{ package.spid }}',
                'chargeid': '{{ package.chargeid }}',
                'secret': '{{ package.secret }}',
                'phonenum': '18118999630',
                'productid': '{{ package.productid }}'
            },
            dataType: 'json',
            success: function (data) {
                alert(data.message);
                if (data.code == "0" || data.code == "131") {
                    //success
                    $('.super button').text('已订购');
                    $('.super button').addClass('ordered');
                }
            }
        });
    })
    {% endif %}
</script>
</html>
